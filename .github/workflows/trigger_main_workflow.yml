# .github/workflows/trigger_main_workflow.yml
name: Trigger Main Conversion Workflow

on:
  push:
    paths:
      - 'conversation/Temp/both_files_ready.txt' # Triggers when both_files_ready.txt is created/modified

jobs:
  dispatch_main:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Create Log Entry for Trigger Workflow
        run: |
          mkdir -p conversation/Logs
          echo "$(date +"%Y-%m-%d %H:%M:%S") - Trigger workflow started for both_files_ready.txt." >> conversation/Logs/workflow_activity.log
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add conversation/Logs/workflow_activity.log
          git commit -m "Log: Trigger workflow started." || echo "No new log entry commit."
          git push || echo "Log push failed."

      - name: Delete both_files_ready.txt marker for next cycle
        run: |
          BOTH_READY_MARKER="conversation/Temp/both_files_ready.txt"
          if [ -f "$BOTH_READY_MARKER" ]; then
            git config user.name "github-actions"
            git config user.email "actions@github.com"
            git rm "$BOTH_READY_MARKER"
            git commit -m "Deleted both_files_ready.txt marker."
            git push
            echo "both_files_ready.txt deleted."
          else
            echo "both_files_ready.txt not found, skipping deletion."
          fi

      - name: Dispatch Main Conversion Workflow
        uses: benc-uk/workflow-dispatch@v1 # A common action for dispatching workflows
        with:
          workflow: main_conversion_workflow.yml # The workflow filename to dispatch
          ref: ${{ github.ref }} # Use the same branch as the current workflow